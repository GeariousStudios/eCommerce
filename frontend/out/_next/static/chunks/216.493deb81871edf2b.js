(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[216],{6216:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>j});var a=n(5155),r=n(7765),l=n(2175),o=n(1151),s=n(2115),i=n(4402),c=n(1133),d=n(5028);n(7548);let u=(0,d.default)(()=>Promise.all([n.e(760),n.e(430)]).then(n.bind(n,4430)),{loadableGenerated:{webpack:()=>[4430]},ssr:!1}),h=(0,s.forwardRef)((e,t)=>{let{value:n,name:r,required:l}=e,o=(0,s.useRef)(null),i=(0,s.useRef)(null);return(0,s.useImperativeHandle)(t,()=>({getContent:()=>{var e,t,n,a;return null!=(a=null==(n=o.current)||null==(t=n.getEditor())||null==(e=t.root)?void 0:e.innerHTML)?a:""},getContentText:()=>{var e,t,n;return null!=(n=null==(t=o.current)||null==(e=t.getEditor())?void 0:e.getText())?n:""},setContent:e=>{var t;let n=null==(t=o.current)?void 0:t.getEditor();n&&n.clipboard.dangerouslyPasteHTML(e,"silent")},getTextarea:()=>i.current})),(0,s.useEffect)(()=>{let e=setInterval(()=>{var t;let a=null==(t=o.current)?void 0:t.getEditor();a&&a.root.innerHTML!==n&&(a.clipboard.dangerouslyPasteHTML(n,"silent"),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),clearInterval(e))},50);return()=>clearInterval(e)},[n]),(0,a.jsxs)("div",{className:"focus-within:z-[calc(var(--z-base)+1) relative w-full rounded border-1 border-[var(--border-main)] focus-within:outline-2 focus-within:outline-offset-2 focus-within:outline-[var(--accent-color)]",children:[(0,a.jsx)(u,{ref:o,id:"quill-editor",theme:"snow",placeholder:" ",modules:{toolbar:[["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],["clean"]],keyboard:{bindings:{tab:{key:9,handler:function(){let e=document.querySelector(":focus + *");return!!e&&(e.focus(),!0)}}}}}}),(0,a.jsx)("textarea",{ref:i,tabIndex:-1,autoComplete:"off",onChange:()=>{},name:r,required:l,defaultValue:"",style:{position:"absolute",width:"100%",bottom:"0",pointerEvents:"none",opacity:"0"}})]})});var m=n(1701),x=n(1972),g=n(8500);let f=e=>{let t=(0,s.useRef)(null),n=(0,s.useRef)(null),[o,d]=(0,s.useState)(""),[u,f]=(0,s.useState)(""),[p,v]=(0,s.useState)(""),[b,j]=(0,s.useState)(""),[y,w]=(0,s.useState)(""),[S,N]=(0,s.useState)(""),[C,k]=(0,s.useState)(!1),I=localStorage.getItem("token"),{notify:T}=(0,g.d)(),A="https://ecommerce-9jo7.onrender.com";(0,s.useEffect)(()=>{C||k(!0)},[]),(0,s.useEffect)(()=>{if(e.isOpen)if(null!==e.newsId&&void 0!==e.newsId)E(e.newsId);else{var n;d(""),f(""),v(""),j(""),null==(n=t.current)||n.setContent("")}},[e.isOpen,e.newsId]);let L=async n=>{var a,r;n.preventDefault();let l=null!=(r=null==(a=t.current)?void 0:a.getContent())?r:"";try{let t=await fetch("".concat(A,"/news/create"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(I)},body:JSON.stringify({date:o,type:u,headline:p,content:l})}),n=await t.json();t.ok?(e.onClose(),e.onNewsUpdated(),T("success","Nyhet skapad!",4e3)):T("error",n.message)}catch(e){T("error",String(e))}},E=async e=>{try{let t=await fetch("".concat(A,"/news/fetch/").concat(e),{headers:{"Content-Type":"application/json"}}),n=await t.json();t.ok?O(n):T("error",n.message)}catch(e){T("error",String(e))}},O=e=>{var t,n,a,r;let l=e.date?new Date(e.date):null;d(l?"".concat(l.getFullYear(),"-").concat(String(l.getMonth()+1).padStart(2,"0"),"-").concat(String(l.getDate()).padStart(2,"0")):""),f(null!=(t=e.type)?t:""),v(null!=(n=e.headline)?n:""),j(null!=(a=e.content)?a:""),w(null!=(r=e.author)?r:""),N(e.authorId)},D=async(n,a)=>{var r,l;n.preventDefault();let s=null!=(l=null==(r=t.current)?void 0:r.getContent())?l:"";try{let t=await fetch("".concat(A,"/news/update/").concat(a),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(I)},body:JSON.stringify({date:o,type:u,headline:p,content:s})}),n=await t.json();if(!t.ok)return void T("error",n.message);e.onClose(),e.onNewsUpdated(),T("success","Nyhet uppdaterad!",4e3)}catch(e){T("error",String(e))}};return(0,a.jsxs)(a.Fragment,{children:[C&&(0,a.jsx)("div",{style:{display:"none"},children:(0,a.jsx)(h,{ref:t,value:"",name:"editor-preload"})}),e.isOpen&&(0,a.jsx)("div",{className:"fixed inset-0 z-[var(--z-overlay)] h-svh w-screen bg-black/50",children:(0,a.jsx)(c.FocusTrap,{focusTrapOptions:{initialFocus:!1,allowOutsideClick:!0,escapeDeactivates:!1},children:(0,a.jsxs)("form",{ref:n,className:"relative top-1/2 left-1/2 z-[var(--z-modal)] flex max-h-[90svh] w-[90vw] max-w-3xl -translate-1/2 flex-col gap-8 overflow-y-auto rounded border-1 border-[var(--border-main)] bg-[var(--bg-modal)] p-4",onSubmit:t=>e.newsId?D(t,e.newsId):L(t),children:[(0,a.jsxs)("h2",{className:"mb-4 flex items-center text-2xl font-semibold",children:[(0,a.jsx)("span",{className:"mr-2 h-6 w-6 text-[var(--accent-color)]",children:e.newsId?(0,a.jsx)(l.A,{}):(0,a.jsx)(r.A,{})}),(0,a.jsx)("span",{children:e.newsId?"Redigera nyhet":"L\xe4gg till nyhet"})]}),(0,a.jsx)(m.A,{id:"date",type:"date",label:"Datum",value:o,onChange:e=>d(String(e)),onModal:!0,required:!0}),(0,a.jsx)(i.A,{label:"Nyhetstyp",value:u,onChange:f,options:[{value:"Release",label:"Release"},{value:"Hotfix",label:"Hotfix"}],onModal:!0,required:!0}),(0,a.jsx)(m.A,{id:"headline",label:"Rubrik",value:p,onChange:e=>v(String(e)),onModal:!0,required:!0}),(0,a.jsx)(h,{ref:t,value:b,name:"content",required:!0}),(0,a.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,a.jsx)("button",{type:"button",onClick:e.onClose,className:"".concat(x.p9," grow"),children:"\xc5ngra"}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e,a,r;let l=null!=(r=null==(e=t.current)?void 0:e.getContentText())?r:"",o=null==(a=t.current)?void 0:a.getTextarea();o&&(o.value=""!==l.trim()?"filled":""),setTimeout(()=>{var e;null==(e=n.current)||e.requestSubmit()},0)},className:"".concat(x.$e," grow-2"),children:e.newsId?"Uppdatera":"L\xe4gg till"})]})]})})})]})};var p=n(3555),v=n(4541),b=n(7877);let j=e=>{let[t,n]=(0,s.useState)([]),[i,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[h,j]=(0,s.useState)(null),[y,w]=(0,s.useState)(!1),[S,N]=(0,s.useState)(""),[C,k]=(0,s.useState)(""),[I,T]=(0,s.useState)(!1),A="https://ecommerce-9jo7.onrender.com",L=localStorage.getItem("token"),{notify:E}=(0,g.d)();(0,s.useEffect)(()=>{let e=localStorage.getItem("postLoginToast");e&&(E("info","V\xe4lkommen, "+e+"!",6e3),localStorage.removeItem("postLoginToast"))},[]);let O=async()=>{try{w(!0);let e=await fetch("".concat(A,"/news/fetch"),{headers:{"Content-Type":"application/json"}}),t=await e.json();e.ok?n(t):E("error",t.message)}catch(e){}finally{w(!1)}},D=async e=>{try{let t=await fetch("".concat(A,"/news/delete/").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(L)}}),a=await t.json();t.ok?(n(t=>t.filter(t=>t.id!==e)),E("success","Nyhet borttagen!",4e3)):E("error",a.message)}catch(e){E("error",String(e))}},R=async e=>{if(e.preventDefault(),!I){T(!0),localStorage.removeItem("token");try{let e=await fetch("".concat(A,"/user/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:S,password:C})}),t=await e.json();e.ok?(localStorage.setItem("token",t.token),localStorage.setItem("postLoginToast",t.message),window.location.reload()):(E("error",t.message),T(!1))}catch(e){E("error",String(e)),T(!1)}}};(0,s.useEffect)(()=>{O()},[]);let q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;j(e),c(!0)},H=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!==e&&j(e),u(e=>!e)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f,{isOpen:i,onClose:()=>{c(!1)},newsId:h,onNewsUpdated:O}),(0,a.jsx)(p.A,{isOpen:d,onClose:H,onConfirm:()=>{null!==h&&D(h),u(!1)}}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row",children:[!1===e.isLoggedIn&&(0,a.jsxs)("div",{className:"flex w-full flex-col lg:w-1/3 lg:min-w-80",children:[(0,a.jsx)("div",{className:"flex h-[40px] items-center rounded-t border-1 border-[var(--border-main)] bg-[var(--bg-grid-header)] px-3 py-2",children:(0,a.jsx)("span",{className:"font-semibold",children:"Logga in"})}),(0,a.jsx)("div",{className:"flex max-h-96 min-h-96 items-center justify-center rounded-b border-1 border-t-0 border-[var(--border-main)] p-4",children:e.isConnected?(0,a.jsxs)("form",{onSubmit:R,className:"flex w-64 flex-col gap-8",children:[(0,a.jsx)(m.A,{id:"username",type:"text",label:"Anv\xe4ndarnamn",onChange:e=>N(String(e)),required:!0}),(0,a.jsx)(m.A,{id:"password",type:"password",label:"L\xf6senord",onChange:e=>k(String(e)),required:!0}),(0,a.jsx)("button",{type:"submit",className:"".concat(x.$e," w-full"),disabled:I,children:"Logga in"}),(0,a.jsx)("span",{className:"-mt-4 flex justify-center text-center",children:(0,a.jsx)("button",{type:"button",onClick:()=>E("error","Ej implementerat!"),className:"".concat(x.$U," "),children:"Gl\xf6mt ditt l\xf6senord?"})})]}):(0,a.jsx)(b.A,{icon:"server",content:"server"})})]}),(0,a.jsxs)("div",{className:"".concat(e.isLoggedIn?"w-full":"lg:w-2/3"," flex w-full flex-col"),children:[(0,a.jsxs)("div",{className:"flex h-[40px] items-center justify-between rounded-t border-1 border-[var(--border-main)] bg-[var(--bg-grid-header)] px-3 py-2",children:[(0,a.jsx)("span",{className:"truncate font-semibold",children:"Nyheter"}),!1!==e.isLoggedIn&&e.isAdmin&&(0,a.jsx)(v.A,{content:"L\xe4gg till nyhet",hideOnClick:!0,children:(0,a.jsx)("button",{type:"button",className:"".concat(x.U0," min-h-6 min-w-6"),onClick:()=>q(null),children:(0,a.jsx)(r.A,{})})})]}),(0,a.jsx)("div",{className:"flex max-h-96 min-h-96 flex-col overflow-y-auto rounded-b border-1 border-t-0 border-[var(--border-main)] p-2",children:e.isAuthReady?y?(0,a.jsx)(b.A,{icon:"loading",content:"H\xe4mtar nyheter..."}):t.length>0?(0,a.jsx)("div",{children:t.map((n,r)=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("article",{className:"group duration-fast flex flex-col p-2 transition-colors hover:bg-[var(--bg-navbar-link)]",children:[(0,a.jsx)("time",{className:"text-xs uppercase",dateTime:n.date,children:new Date(n.date).toLocaleDateString("sv-SE",{day:"numeric",month:"long",year:"numeric"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-xl text-[var(--accent-color)]",children:n.type}),!1!==e.isLoggedIn&&e.isAdmin&&(0,a.jsxs)("div",{className:"mr-2 hidden gap-2 group-hover:flex",children:[(0,a.jsx)(v.A,{content:"Redigera nyhet",hideOnClick:!0,children:(0,a.jsx)("button",{type:"button",className:"".concat(x.U0),onClick:()=>q(n.id),children:(0,a.jsx)(l.A,{})})}),(0,a.jsx)(v.A,{content:"Ta bort nyhet",hideOnClick:!0,children:(0,a.jsx)("button",{type:"button",className:"".concat(x.Xd),onClick:()=>H(n.id),children:(0,a.jsx)(o.A,{})})})]})]}),(0,a.jsx)("h4",{className:"text-lg font-semibold",children:n.headline}),(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:n.content}}),(0,a.jsxs)("small",{className:"text-[var(--text-secondary)] italic",children:["Publicerad av:"," ",e.isAdmin?n.author+" (ID: "+n.authorId+")":n.author]})]}),r!==t.length-1&&(0,a.jsx)("hr",{className:"text-[var(--border-main)]"})]},r))}):e.isConnected?(0,a.jsx)(b.A,{content:"Det finns tyv\xe4rr inga nyheter f\xf6r tillf\xe4llet!"}):(0,a.jsx)(b.A,{icon:"server",content:"server"}):""})]})]})]})}},7548:()=>{}}]);